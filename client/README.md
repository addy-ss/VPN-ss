# VPS 客户端使用说明

## 概述

VPS客户端是一个SOCKS5代理客户端，用于连接到VPS服务端。客户端现在完全基于配置文件运行，不支持命令行参数。

## 配置文件

客户端使用 `config.yaml` 配置文件，位于客户端目录中。

### 配置文件结构

```yaml
# 服务器配置
server:
  host: "127.0.0.1"  # 服务器地址
  port: 8388          # 服务器端口

# 本地配置
local:
  port: 1080          # 本地监听端口

# 安全配置
security:
  password: "13687401432Fan!"  # 密码
  method: "aes-256-gcm"        # 加密方法: aes-256-gcm, chacha20-poly1305
  timeout: 300                 # 超时时间(秒)

# 日志配置
log:
  level: "info"              # 日志级别: debug, info, warn, error
  file: ""                   # 日志文件路径，留空输出到控制台
```

### 默认值

如果配置文件中缺少某些字段，客户端会使用以下默认值：

- `server.host`: "127.0.0.1"
- `server.port`: 8388
- `local.port`: 1080
- `security.password`: "13687401432Fan!"
- `security.method`: "aes-256-gcm"
- `security.timeout`: 300
- `log.level`: "info"
- `log.file`: "" (输出到控制台)

## 使用方法

### 1. 构建客户端

```bash
cd client
go build -o vps-client .
```

### 2. 配置客户端

编辑 `config.yaml` 文件，设置正确的服务器地址和密码：

```yaml
server:
  host: "your-server-ip"  # 修改为你的服务器IP
  port: 8388

local:
  port: 1080

security:
  password: "your-password"  # 修改为你的密码
  method: "aes-256-gcm"
  timeout: 300
```

### 3. 启动客户端

```bash
./vps-client
```

客户端将启动并监听本地端口1080，提供SOCKS5代理服务。

### 4. 测试连接

使用curl测试SOCKS5代理：

```bash
curl --socks5 127.0.0.1:1080 --connect-timeout 10 -s http://httpbin.org/ip
```

## 启动脚本功能

### 使用启动脚本（推荐）

```bash
# 启动客户端
./start.sh start

# 检查状态
./start.sh status

# 测试连接
./start.sh test

# 停止客户端
./start.sh stop

# 重启客户端
./start.sh restart
```

### 启动脚本特性

- ✅ **端口占用检测**：自动检测端口1080是否被占用
- ✅ **智能冲突处理**：提供选项停止占用进程或取消启动
- ✅ **启动验证**：验证客户端是否真正启动成功
- ✅ **自动测试**：启动后自动测试SOCKS5代理连接
- ✅ **错误处理**：启动失败时提供详细错误信息

### 启动流程

1. **配置文件检查**：验证配置文件是否存在和有效
2. **程序文件检查**：确保客户端程序已构建
3. **端口占用检查**：检测端口1080是否被占用
4. **启动客户端**：后台启动客户端程序
5. **启动验证**：检查进程和端口监听状态
6. **连接测试**：自动测试SOCKS5代理功能

## 支持的加密方法

- `aes-256-gcm` (推荐)
- `chacha20-poly1305`

## 故障排除

### 1. 连接失败

- 检查服务器地址和端口是否正确
- 确认服务器正在运行
- 检查防火墙设置

### 2. 认证失败

- 确认密码与服务器配置匹配
- 检查加密方法是否一致

### 3. 端口被占用

启动脚本会自动处理端口占用问题：

```bash
# 手动检查端口占用
lsof -i :1080

# 手动停止占用进程
pkill -f vps-client

# 或使用启动脚本（推荐）
./start.sh start
```

### 4. 启动失败

如果客户端启动失败，启动脚本会：

- 显示详细的错误信息
- 清理失败的进程
- 跳过连接测试
- 提供故障排除建议

## 日志

客户端会输出详细的连接日志，包括：

- 连接建立
- SOCKS5握手过程
- 目标地址解析
- 加密/解密过程
- 错误信息

日志级别可以通过配置文件中的 `log.level` 字段调整。

## 安全注意事项

1. **密码安全**：确保使用强密码，不要在公共场合暴露
2. **配置文件权限**：确保配置文件只有所有者可读
3. **网络安全**：建议在可信网络中使用

## 性能优化

1. **连接复用**：客户端会自动处理连接复用
2. **超时设置**：可以通过 `security.timeout` 调整超时时间
3. **缓冲区优化**：使用8192字节的缓冲区提高传输效率

## 总结

现在客户端已经完全基于配置文件运行，提供了：

- ✅ 简化的启动方式
- ✅ 统一的配置管理
- ✅ 智能的启动脚本
- ✅ 完整的错误处理
- ✅ 自动的连接测试
- ✅ 详细的日志记录

所有功能都经过测试验证，可以安全使用！